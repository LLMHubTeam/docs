---
title: "Anthropic Messages"
---

<Info>
    **å®˜æ–¹æ–‡æ¡£**
    - [Anthropic Messages](https://docs.anthropic.com/en/api/messages)
    - [Anthropic Streaming Messages](https://docs.anthropic.com/en/api/messages-streaming)
</Info>

## ç®€ä»‹

ç»™å®šä¸€ç»„åŒ…å«æ–‡æœ¬å’Œ/æˆ–å›¾åƒå†…å®¹çš„ç»“æ„åŒ–è¾“å…¥æ¶ˆæ¯åˆ—è¡¨ï¼Œæ¨¡å‹å°†ç”Ÿæˆå¯¹è¯ä¸­çš„ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚Messages API å¯ç”¨äºå•æ¬¡æŸ¥è¯¢æˆ–æ— çŠ¶æ€çš„å¤šè½®å¯¹è¯ã€‚

## è¯·æ±‚ç¤ºä¾‹

### åŸºç¡€æ–‡æœ¬å¯¹è¯

```bash
curl https://api.llmhub.com.cn/v1/messages \
     --header "anthropic-version: 2023-06-01" \
     --header "content-type: application/json" \
     --header "x-api-key: $LLM_Hub_API_KEY" \
     --data \
'{
    "model": "claude-3-5-sonnet-20241022",
    "max_tokens": 1024,
    "messages": [
        {"role": "user", "content": "Hello, world"}
    ]
}'
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "content": [
    {
      "text": "Hi! My name is Claude.",
      "type": "text"
    }
  ],
  "id": "msg_013Zva2CMHLNnXjNJKqJ2EF",
  "model": "claude-3-5-sonnet-20241022", 
  "role": "assistant",
  "stop_reason": "end_turn",
  "stop_sequence": null,
  "type": "message",
  "usage": {
    "input_tokens": 2095,
    "output_tokens": 503
  }
}
```

### å›¾åƒåˆ†æå¯¹è¯

```bash
curl https://api.llmhub.com.cn/v1/messages \
     --header "anthropic-version: 2023-06-01" \
     --header "content-type: application/json" \
     --header "x-api-key: $LLM_Hub_API_KEY" \
     --data \
'{
    "model": "claude-3-5-sonnet-20241022",
    "messages": [
        {
            "role": "user",
            "content": [
                {
                    "type": "image",
                    "source": {
                        "type": "base64",
                        "media_type": "image/jpeg",
                        "data": "/9j/4AAQSkZJRg..."
                    }
                },
                {
                    "type": "text",
                    "text": "è¿™å¼ å›¾ç‰‡é‡Œæœ‰ä»€ä¹ˆ?"
                }
            ]
        }
    ]
}'
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "content": [
    {
      "text": "è¿™å¼ å›¾ç‰‡æ˜¾ç¤ºäº†ä¸€åªæ©™è‰²çš„çŒ«å’ªæ­£åœ¨çª—å°ä¸Šæ™’å¤ªé˜³ã€‚çŒ«å’ªçœ‹èµ·æ¥å¾ˆæ”¾æ¾ï¼Œçœ¯ç€çœ¼ç›äº«å—é˜³å…‰ã€‚çª—å¤–å¯ä»¥çœ‹åˆ°ä¸€äº›ç»¿è‰²çš„æ¤ç‰©ã€‚",
      "type": "text"
    }
  ],
  "id": "msg_013Zva2CMHLNnXjNJKqJ2EF",
  "model": "claude-3-5-sonnet-20241022",
  "role": "assistant",
  "stop_reason": "end_turn",
  "stop_sequence": null,
  "type": "message",
  "usage": {
    "input_tokens": 3050,
    "output_tokens": 892
  }
}
```

### å·¥å…·è°ƒç”¨

```bash
curl https://api.llmhub.com.cn/v1/messages \
     --header "anthropic-version: 2023-06-01" \
     --header "content-type: application/json" \
     --header "x-api-key: $LLM_Hub_API_KEY" \
     --data \
'{
    "model": "claude-3-5-sonnet-20241022",
    "messages": [
        {
            "role": "user", 
            "content": "ä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·?"
        }
    ],
    "tools": [
        {
            "name": "get_weather",
            "description": "è·å–æŒ‡å®šä½ç½®çš„å½“å‰å¤©æ°”",
            "input_schema": {
                "type": "object",
                "properties": {
                    "location": {
                        "type": "string",
                        "description": "åŸå¸‚åç§°,å¦‚:åŒ—äº¬"
                    }
                },
                "required": ["location"]
            }
        }
    ]
}'
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "content": [
    {
      "type": "tool_use",
      "id": "toolu_01D7FLrfh4GYq7yT1ULFeyMV",
      "name": "get_weather",
      "input": { "location": "åŒ—äº¬" }
    }
  ],
  "id": "msg_013Zva2CMHLNnXjNJKqJ2EF",
  "model": "claude-3-5-sonnet-20241022",
  "role": "assistant",
  "stop_reason": "tool_use",
  "stop_sequence": null,
  "type": "message",
  "usage": {
    "input_tokens": 2156,
    "output_tokens": 468
  }
}
```

### æµå¼å“åº”

```bash
curl https://api.llmhub.com.cn/v1/messages \
     --header "anthropic-version: 2023-06-01" \
     --header "content-type: application/json" \
     --header "x-api-key: $LLM_Hub_API_KEY" \
     --data \
'{
    "model": "claude-3-5-sonnet-20241022",
    "messages": [
        {
            "role": "user",
            "content": "è®²ä¸ªæ•…äº‹"
        }
    ],
    "stream": true
}'
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "type": "message_start",
  "message": {
    "id": "msg_013Zva2CMHLNnXjNJKqJ2EF",
    "model": "claude-3-5-sonnet-20241022",
    "role": "assistant",
    "type": "message"
  }
}
{
  "type": "content_block_start",
  "index": 0,
  "content_block": {
    "type": "text"
  }
}
{
  "type": "content_block_delta",
  "index": 0,
  "delta": {
    "text": "ä»å‰"
  }
}
{
  "type": "content_block_delta",
  "index": 0,
  "delta": {
    "text": "æœ‰ä¸€åª"
  }
}
{
  "type": "content_block_delta",
  "index": 0,
  "delta": {
    "text": "å°å…”å­..."
  }
}
{
  "type": "content_block_stop",
  "index": 0
}
{
  "type": "message_delta",
  "delta": {
    "stop_reason": "end_turn",
    "usage": {
      "input_tokens": 2045,
      "output_tokens": 628
    }
  }
}
{
  "type": "message_stop"
}
```

## è¯·æ±‚

### ç«¯ç‚¹

```
POST /v1/messages
```

### é‰´æƒæ–¹æ³•

åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹è¿›è¡Œ API å¯†é’¥è®¤è¯ï¼š

```
x-api-key: $LLM_Hub_API_KEY
```

å…¶ä¸­ `$LLM_Hub_API_KEY` æ˜¯æ‚¨çš„ API å¯†é’¥ã€‚æ‚¨å¯ä»¥é€šè¿‡æ§åˆ¶å°è·å– API å¯†é’¥ï¼Œæ¯ä¸ªå¯†é’¥ä»…é™äºä¸€ä¸ªå·¥ä½œåŒºä½¿ç”¨ã€‚

### è¯·æ±‚å¤´å‚æ•°

#### `anthropic-beta`

- ç±»å‹ï¼šå­—ç¬¦ä¸²
- å¿…éœ€ï¼šå¦

æŒ‡å®šè¦ä½¿ç”¨çš„ beta ç‰ˆæœ¬ï¼Œæ”¯æŒç”¨é€—å·åˆ†éš”çš„åˆ—è¡¨å¦‚ `beta1,beta2`ï¼Œæˆ–å¤šæ¬¡æŒ‡å®šè¯¥è¯·æ±‚å¤´ã€‚

#### `anthropic-version`

- ç±»å‹ï¼šå­—ç¬¦ä¸²
- å¿…éœ€ï¼šæ˜¯

æŒ‡å®šè¦ä½¿ç”¨çš„ API ç‰ˆæœ¬ã€‚

### è¯·æ±‚ä½“å‚æ•°

#### `max_tokens`

- ç±»å‹ï¼šæ•´æ•°
- å¿…éœ€ï¼šæ˜¯

ç”Ÿæˆçš„æœ€å¤§ token æ•°é‡ã€‚ä¸åŒæ¨¡å‹æœ‰ä¸åŒçš„é™åˆ¶ï¼Œè¯¦è§æ¨¡å‹æ–‡æ¡£ã€‚èŒƒå›´ `x > 1`ã€‚

#### `messages`

- ç±»å‹ï¼šå¯¹è±¡æ•°ç»„
- å¿…éœ€ï¼šæ˜¯

è¾“å…¥æ¶ˆæ¯åˆ—è¡¨ã€‚æ¨¡å‹è¢«è®­ç»ƒä¸ºåœ¨ç”¨æˆ·å’ŒåŠ©æ‰‹ä¹‹é—´äº¤æ›¿è¿›è¡Œå¯¹è¯ã€‚åˆ›å»ºæ–°æ¶ˆæ¯æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ messages å‚æ•°æŒ‡å®šä¹‹å‰çš„å¯¹è¯è½®æ¬¡ï¼Œæ¨¡å‹å°†ç”Ÿæˆå¯¹è¯ä¸­çš„ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚è¿ç»­çš„ç”¨æˆ·æˆ–åŠ©æ‰‹æ¶ˆæ¯ä¼šè¢«åˆå¹¶ä¸ºå•ä¸ªè½®æ¬¡ã€‚

æ¯ä¸ªæ¶ˆæ¯å¿…é¡»åŒ…å« `role` å’Œ `content` å­—æ®µã€‚æ‚¨å¯ä»¥æŒ‡å®šå•ä¸ªç”¨æˆ·è§’è‰²æ¶ˆæ¯ï¼Œæˆ–åŒ…å«å¤šä¸ªç”¨æˆ·å’ŒåŠ©æ‰‹æ¶ˆæ¯ã€‚å¦‚æœæœ€åä¸€æ¡æ¶ˆæ¯ä½¿ç”¨åŠ©æ‰‹è§’è‰²ï¼Œå“åº”å†…å®¹å°†ç›´æ¥ä»è¯¥æ¶ˆæ¯çš„å†…å®¹ç»§ç»­ï¼Œè¿™å¯ä»¥ç”¨æ¥çº¦æŸæ¨¡å‹çš„å“åº”ã€‚

**å•æ¡ç”¨æˆ·æ¶ˆæ¯ç¤ºä¾‹:**
```json
[{"role": "user", "content": "Hello, Claude"}]
```

**å¤šè½®å¯¹è¯ç¤ºä¾‹:**
```json
[
  {"role": "user", "content": "ä½ å¥½ã€‚"},
  {"role": "assistant", "content": "ä½ å¥½ï¼æˆ‘æ˜¯ Claudeã€‚æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"},
  {"role": "user", "content": "è¯·ç”¨ç®€å•çš„è¯è§£é‡Šä»€ä¹ˆæ˜¯ LLMï¼Ÿ"}
]
```

**éƒ¨åˆ†å¡«å……çš„å“åº”ç¤ºä¾‹:**
```json
[
  {"role": "user", "content": "å¤ªé˜³çš„å¸Œè…Šè¯­åå­—æ˜¯ä»€ä¹ˆ? (A) Sol (B) Helios (C) Sun"},
  {"role": "assistant", "content": "æ­£ç¡®ç­”æ¡ˆæ˜¯ ("}
]
```

æ¯ä¸ªæ¶ˆæ¯çš„ content å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–å†…å®¹å—æ•°ç»„ã€‚ä½¿ç”¨å­—ç¬¦ä¸²ç›¸å½“äºä¸€ä¸ª "text" ç±»å‹çš„å†…å®¹å—æ•°ç»„çš„ç®€å†™ã€‚ä»¥ä¸‹ä¸¤ç§å†™æ³•ç­‰æ•ˆï¼š

```json
{"role": "user", "content": "Hello, Claude"}
```

```json
{
  "role": "user", 
  "content": [{"type": "text", "text": "Hello, Claude"}]
}
```

ä» Claude 3 æ¨¡å‹å¼€å§‹ï¼Œæ‚¨è¿˜å¯ä»¥å‘é€å›¾ç‰‡å†…å®¹å—ï¼š

```json
{
  "role": "user",
  "content": [
    {
      "type": "image",
      "source": {
        "type": "base64",
        "media_type": "image/jpeg",
        "data": "/9j/4AAQSkZJRg..."
      }
    },
    {
      "type": "text",
      "text": "è¿™å¼ å›¾ç‰‡é‡Œæœ‰ä»€ä¹ˆ?"
    }
  ]
}
```

> ç›®å‰æ”¯æŒçš„å›¾ç‰‡æ ¼å¼åŒ…æ‹¬: base64, image/jpegã€image/pngã€image/gif å’Œ image/webpã€‚

##### `messages.role`

- ç±»å‹ï¼šæšä¸¾å­—ç¬¦ä¸²
- å¿…éœ€ï¼šæ˜¯
- å¯é€‰å€¼ï¼šuser, assistant

æ³¨æ„ï¼šMessages API ä¸­æ²¡æœ‰ "system" è§’è‰²ï¼Œå¦‚æœéœ€è¦ç³»ç»Ÿæç¤ºï¼Œè¯·ä½¿ç”¨é¡¶å±‚çš„ system å‚æ•°ã€‚

##### `messages.content`

- ç±»å‹ï¼šå­—ç¬¦ä¸²æˆ–å¯¹è±¡æ•°ç»„
- å¿…éœ€ï¼šæ˜¯

æ¶ˆæ¯å†…å®¹å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ä¹‹ä¸€ï¼š

###### æ–‡æœ¬å†…å®¹ (Text)

```json
{
  "type": "text",          // å¿…éœ€ï¼Œæšä¸¾å€¼: "text"
  "text": "Hello, Claude", // å¿…éœ€ï¼Œæœ€å°é•¿åº¦: 1
  "cache_control": {
    "type": "ephemeral"    // å¯é€‰ï¼Œæšä¸¾å€¼: "ephemeral"
  }
}
```

###### å›¾ç‰‡å†…å®¹ (Image)

```json
{
  "type": "image",         // å¿…éœ€ï¼Œæšä¸¾å€¼: "image"
  "source": {             // å¿…éœ€
    "type": "base64",     // å¿…éœ€ï¼Œæšä¸¾å€¼: "base64"
    "media_type": "image/jpeg", // å¿…éœ€ï¼Œæ”¯æŒ: image/jpeg, image/png, image/gif, image/webp
    "data": "/9j/4AAQSkZJRg..."  // å¿…éœ€ï¼Œbase64 ç¼–ç çš„å›¾ç‰‡æ•°æ®
  },
  "cache_control": {
    "type": "ephemeral"    // å¯é€‰ï¼Œæšä¸¾å€¼: "ephemeral"
  }
}
```

###### å·¥å…·ä½¿ç”¨ (Tool Use)

```json
{
  "type": "tool_use",      // å¿…éœ€ï¼Œæšä¸¾å€¼: "tool_use"ï¼Œé»˜è®¤å€¼
  "id": "toolu_xyz...",    // å¿…éœ€ï¼Œå·¥å…·ä½¿ç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦
  "name": "get_weather",   // å¿…éœ€ï¼Œå·¥å…·åç§°ï¼Œæœ€å°é•¿åº¦: 1
  "input": {              // å¿…éœ€ï¼Œå·¥å…·çš„è¾“å…¥å‚æ•°å¯¹è±¡
    // å·¥å…·è¾“å…¥å‚æ•°ï¼Œå…·ä½“æ ¼å¼ç”±å·¥å…·çš„ input_schema å®šä¹‰
  },
  "cache_control": {
    "type": "ephemeral"    // å¯é€‰ï¼Œæšä¸¾å€¼: "ephemeral"
  }
}
```

###### å·¥å…·ç»“æœ (Tool Result)

```json
{
  "type": "tool_result",   // å¿…éœ€ï¼Œæšä¸¾å€¼: "tool_result"
  "tool_use_id": "toolu_xyz...",  // å¿…éœ€
  "content": "ç»“æœå†…å®¹",   // å¿…éœ€ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–å†…å®¹å—æ•°ç»„
  "is_error": false,      // å¯é€‰ï¼Œå¸ƒå°”å€¼
  "cache_control": {
    "type": "ephemeral"    // å¯é€‰ï¼Œæšä¸¾å€¼: "ephemeral"
  }
}
```

å½“ content ä¸ºå†…å®¹å—æ•°ç»„æ—¶ï¼Œæ¯ä¸ªå†…å®¹å—å¯ä»¥æ˜¯æ–‡æœ¬æˆ–å›¾ç‰‡ï¼š

```json
{
  "type": "tool_result",
  "tool_use_id": "toolu_xyz...",
  "content": [
    {
      "type": "text",      // å¿…éœ€ï¼Œæšä¸¾å€¼: "text"
      "text": "åˆ†æç»“æœ",   // å¿…éœ€ï¼Œæœ€å°é•¿åº¦: 1
      "cache_control": {
        "type": "ephemeral" // å¯é€‰ï¼Œæšä¸¾å€¼: "ephemeral"
      }
    },
    {
      "type": "image",     // å¿…éœ€ï¼Œæšä¸¾å€¼: "image"
      "source": {         // å¿…éœ€
        "type": "base64", // å¿…éœ€ï¼Œæšä¸¾å€¼: "base64"
        "media_type": "image/jpeg",
        "data": "..."
      },
      "cache_control": {
        "type": "ephemeral"
      }
    }
  ]
}
```

###### æ–‡æ¡£ (Document)

```json
{
  "type": "document",      // å¿…éœ€ï¼Œæšä¸¾å€¼: "document"
  "source": {             // å¿…éœ€
    // æ–‡æ¡£æºæ•°æ®
  },
  "cache_control": {
    "type": "ephemeral"    // å¯é€‰ï¼Œæšä¸¾å€¼: "ephemeral"
  }
}
```

æ³¨æ„ï¼š
1. æ¯ç§ç±»å‹éƒ½å¯ä»¥åŒ…å«å¯é€‰çš„ `cache_control` å­—æ®µï¼Œç”¨äºæ§åˆ¶å†…å®¹çš„ç¼“å­˜è¡Œä¸º
2. æ–‡æœ¬å†…å®¹çš„æœ€å°é•¿åº¦ä¸º 1
3. æ‰€æœ‰ç±»å‹çš„ type å­—æ®µéƒ½æ˜¯å¿…éœ€çš„æšä¸¾å­—ç¬¦ä¸²
4. å·¥å…·ç»“æœçš„ content å­—æ®µæ”¯æŒå­—ç¬¦ä¸²æˆ–åŒ…å«æ–‡æœ¬/å›¾ç‰‡çš„å†…å®¹å—æ•°ç»„

#### `model`

- ç±»å‹ï¼šå­—ç¬¦ä¸²
- å¿…éœ€ï¼šæ˜¯

è¦ä½¿ç”¨çš„æ¨¡å‹åç§°ï¼Œè¯¦è§æ¨¡å‹æ–‡æ¡£ã€‚èŒƒå›´ `1 - 256` ä¸ªå­—ç¬¦ã€‚

#### `metadata`

- ç±»å‹ï¼šå¯¹è±¡
- å¿…éœ€ï¼šå¦

æè¿°è¯·æ±‚å…ƒæ•°æ®çš„å¯¹è±¡ã€‚åŒ…å«ä»¥ä¸‹å¯é€‰å­—æ®µï¼š

- `user_id`: ä¸è¯·æ±‚å…³è”çš„ç”¨æˆ·çš„å¤–éƒ¨æ ‡è¯†ç¬¦ã€‚åº”è¯¥æ˜¯ uuidã€å“ˆå¸Œå€¼æˆ–å…¶ä»–ä¸é€æ˜æ ‡è¯†ç¬¦ã€‚ä¸è¦åŒ…å«ä»»ä½•æ ‡è¯†ä¿¡æ¯å¦‚å§“åã€é‚®ç®±æˆ–ç”µè¯å·ç ã€‚æœ€å¤§é•¿åº¦ï¼š256ã€‚

#### `stop_sequences`

- ç±»å‹ï¼šå­—ç¬¦ä¸²æ•°ç»„
- å¿…éœ€ï¼šå¦

è‡ªå®šä¹‰çš„åœæ­¢ç”Ÿæˆçš„æ–‡æœ¬åºåˆ—ã€‚

#### `stream`

- ç±»å‹ï¼šå¸ƒå°”å€¼
- å¿…éœ€ï¼šå¦

æ˜¯å¦ä½¿ç”¨æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE) æ¥å¢é‡è¿”å›å“åº”å†…å®¹ã€‚

#### `system`

- ç±»å‹ï¼šå­—ç¬¦ä¸²
- å¿…éœ€ï¼šå¦

ç³»ç»Ÿ promptï¼Œä¸º Claude æä¾›èƒŒæ™¯å’ŒæŒ‡ä»¤ã€‚è¿™æ˜¯ä¸€ç§ä¸ºæ¨¡å‹æä¾›ä¸Šä¸‹æ–‡å’Œç‰¹å®šç›®æ ‡æˆ–è§’è‰²çš„æ–¹å¼ã€‚æ³¨æ„è¿™ä¸æ¶ˆæ¯ä¸­çš„ role ä¸åŒï¼ŒMessages API ä¸­æ²¡æœ‰ "system" è§’è‰²ã€‚

#### `temperature`

- ç±»å‹ï¼šæ•°å­—
- å¿…éœ€ï¼šå¦
- é»˜è®¤å€¼ï¼š1.0

æ§åˆ¶ç”Ÿæˆéšæœºæ€§ï¼Œ0.0 - 1.0ã€‚èŒƒå›´ `0 < x < 1`ã€‚å»ºè®®å¯¹äºåˆ†ææ€§/é€‰æ‹©é¢˜ç±»ä»»åŠ¡ä½¿ç”¨æ¥è¿‘ 0.0 çš„å€¼ï¼Œå¯¹äºåˆ›é€ æ€§å’Œç”Ÿæˆæ€§ä»»åŠ¡ä½¿ç”¨æ¥è¿‘ 1.0 çš„å€¼ã€‚

æ³¨æ„ï¼šå³ä½¿ temperature è®¾ç½®ä¸º 0.0ï¼Œç»“æœä¹Ÿä¸ä¼šå®Œå…¨ç¡®å®šã€‚

#### ğŸ†• `thinking`

- ç±»å‹ï¼šå¯¹è±¡
- å¿…éœ€ï¼šå¦

é…ç½® Claude çš„æ‰©å±•æ€è€ƒåŠŸèƒ½ã€‚å¯ç”¨æ—¶ï¼Œå“åº”å°†åŒ…å«å±•ç¤º Claude åœ¨ç»™å‡ºæœ€ç»ˆç­”æ¡ˆå‰çš„æ€è€ƒè¿‡ç¨‹çš„å†…å®¹å—ã€‚éœ€è¦è‡³å°‘ 1,024 ä¸ª token çš„é¢„ç®—ï¼Œå¹¶è®¡å…¥æ‚¨çš„ max_tokens é™åˆ¶ã€‚

å¯ä»¥è®¾ç½®ä¸ºä»¥ä¸‹ä¸¤ç§æ¨¡å¼ä¹‹ä¸€ï¼š

##### 1. å¯ç”¨æ¨¡å¼

```json
{
  "type": "enabled",
  "budget_tokens": 2048
}
```

- `type`: å¿…éœ€ï¼Œæšä¸¾å€¼: "enabled"
- `budget_tokens`: å¿…éœ€ï¼Œæ•´æ•°ã€‚å†³å®š Claude å¯ä»¥ç”¨äºå†…éƒ¨æ¨ç†è¿‡ç¨‹çš„ token æ•°é‡ã€‚æ›´å¤§çš„é¢„ç®—å¯ä»¥è®©æ¨¡å‹å¯¹å¤æ‚é—®é¢˜è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æï¼Œæé«˜å“åº”è´¨é‡ã€‚å¿…é¡» â‰¥1024 ä¸”å°äº max_tokensã€‚èŒƒå›´ `x > 1024`ã€‚

##### 2. ç¦ç”¨æ¨¡å¼

```json
{
  "type": "disabled"
}
```

- `type`: å¿…éœ€ï¼Œæšä¸¾å€¼: "disabled"

#### `tool_choice`

- ç±»å‹ï¼šå¯¹è±¡
- å¿…éœ€ï¼šå¦

æ§åˆ¶æ¨¡å‹å¦‚ä½•ä½¿ç”¨æä¾›çš„å·¥å…·ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹ä¸‰ç§ç±»å‹ä¹‹ä¸€ï¼š

##### 1. Auto æ¨¡å¼ (è‡ªåŠ¨é€‰æ‹©)

```json
{
  "type": "auto",  // å¿…éœ€ï¼Œæšä¸¾å€¼: "auto"
  "disable_parallel_tool_use": false  // å¯é€‰ï¼Œé»˜è®¤ falseã€‚å¦‚æœä¸º trueï¼Œæ¨¡å‹æœ€å¤šåªä¼šä½¿ç”¨ä¸€ä¸ªå·¥å…·
}
```

##### 2. Any æ¨¡å¼ (ä»»æ„å·¥å…·)

```json
{
  "type": "any",  // å¿…éœ€ï¼Œæšä¸¾å€¼: "any"
  "disable_parallel_tool_use": false  // å¯é€‰ï¼Œé»˜è®¤ falseã€‚å¦‚æœä¸º trueï¼Œæ¨¡å‹å°†æ°å¥½ä½¿ç”¨ä¸€ä¸ªå·¥å…·
}
```

##### 3. Tool æ¨¡å¼ (æŒ‡å®šå·¥å…·)

```json
{
  "type": "tool",  // å¿…éœ€ï¼Œæšä¸¾å€¼: "tool"
  "name": "get_weather",  // å¿…éœ€ï¼ŒæŒ‡å®šè¦ä½¿ç”¨çš„å·¥å…·åç§°
  "disable_parallel_tool_use": false  // å¯é€‰ï¼Œé»˜è®¤ falseã€‚å¦‚æœä¸º trueï¼Œæ¨¡å‹å°†æ°å¥½ä½¿ç”¨ä¸€ä¸ªå·¥å…·
}
```

æ³¨æ„ï¼š
1. Auto æ¨¡å¼ï¼šæ¨¡å‹å¯ä»¥è‡ªè¡Œå†³å®šæ˜¯å¦ä½¿ç”¨å·¥å…·
2. Any æ¨¡å¼ï¼šæ¨¡å‹å¿…é¡»ä½¿ç”¨å·¥å…·ï¼Œä½†å¯ä»¥é€‰æ‹©ä»»ä½•å¯ç”¨çš„å·¥å…·
3. Tool æ¨¡å¼ï¼šæ¨¡å‹å¿…é¡»ä½¿ç”¨æŒ‡å®šçš„å·¥å…·

#### `tools`

- ç±»å‹ï¼šå¯¹è±¡æ•°ç»„
- å¿…éœ€ï¼šå¦

å®šä¹‰æ¨¡å‹å¯èƒ½ä½¿ç”¨çš„å·¥å…·ã€‚å·¥å…·å¯ä»¥æ˜¯è‡ªå®šä¹‰å·¥å…·æˆ–å†…ç½®å·¥å…·ç±»å‹ï¼š

##### 1. è‡ªå®šä¹‰å·¥å…·ï¼ˆToolï¼‰

æ¯ä¸ªè‡ªå®šä¹‰å·¥å…·å®šä¹‰åŒ…å«ï¼š

- `type`: å¯é€‰ï¼Œæšä¸¾å€¼: "custom"
- `name`: å·¥å…·åç§°ï¼Œå¿…éœ€ï¼Œ1-64 ä¸ªå­—ç¬¦
- `description`: å·¥å…·æè¿°ï¼Œå»ºè®®å°½å¯èƒ½è¯¦ç»†
- `input_schema`: å·¥å…·è¾“å…¥çš„ JSON Schema å®šä¹‰ï¼Œå¿…éœ€
- `cache_control`: ç¼“å­˜æ§åˆ¶ï¼Œå¯é€‰ï¼Œtype ä¸º "ephemeral"

ç¤ºä¾‹ï¼š
```json
[
  {
    "type": "custom",
    "name": "get_weather",
    "description": "è·å–æŒ‡å®šä½ç½®çš„å½“å‰å¤©æ°”",
    "input_schema": {
      "type": "object",
      "properties": {
        "location": {
          "type": "string",
          "description": "åŸå¸‚åç§°,å¦‚:åŒ—äº¬"
        }
      },
      "required": ["location"]
    }
  }
]
```

##### 2. è®¡ç®—æœºå·¥å…· (ComputerUseTool)

```json
{
  "type": "computer_20241022",  // å¿…éœ€
  "name": "computer",           // å¿…éœ€ï¼Œæšä¸¾å€¼: "computer"
  "display_width_px": 1024,     // å¿…éœ€ï¼Œæ˜¾ç¤ºå®½åº¦(åƒç´ )
  "display_height_px": 768,     // å¿…éœ€ï¼Œæ˜¾ç¤ºé«˜åº¦(åƒç´ )
  "display_number": 0,          // å¯é€‰ï¼ŒX11 æ˜¾ç¤ºç¼–å·
  "cache_control": {
    "type": "ephemeral"         // å¯é€‰
  }
}
```

##### 3. Bash å·¥å…· (BashTool)

```json
{
  "type": "bash_20241022",      // å¿…éœ€
  "name": "bash",               // å¿…éœ€ï¼Œæšä¸¾å€¼: "bash"
  "cache_control": {
    "type": "ephemeral"         // å¯é€‰
  }
}
```

##### 4. æ–‡æœ¬ç¼–è¾‘å™¨å·¥å…· (TextEditor)

```json
{
  "type": "text_editor_20241022", // å¿…éœ€
  "name": "str_replace_editor",   // å¿…éœ€ï¼Œæšä¸¾å€¼: "str_replace_editor"
  "cache_control": {
    "type": "ephemeral"           // å¯é€‰
  }
}
```

å½“æ¨¡å‹ä½¿ç”¨å·¥å…·æ—¶ï¼Œä¼šè¿”å› tool_use å†…å®¹å—ï¼š

```json
[
  {
    "type": "tool_use",
    "id": "toolu_01D7FLrfh4GYq7yT1ULFeyMV",
    "name": "get_weather",
    "input": { "location": "åŒ—äº¬" }
  }
]
```

æ‚¨å¯ä»¥æ‰§è¡Œå·¥å…·å¹¶é€šè¿‡ tool_result å†…å®¹å—è¿”å›ç»“æœï¼š

```json
[
  {
    "type": "tool_result",
    "tool_use_id": "toolu_01D7FLrfh4GYq7yT1ULFeyMV",
    "content": "åŒ—äº¬å½“å‰å¤©æ°”æ™´æœ—ï¼Œæ¸©åº¦ 25Â°C"
  }
]
```

#### `top_k`

- ç±»å‹ï¼šæ•´æ•°
- å¿…éœ€ï¼šå¦
- èŒƒå›´ï¼šx > 0

ä» token çš„å‰ K ä¸ªé€‰é¡¹ä¸­é‡‡æ ·ã€‚ç”¨äºç§»é™¤ä½æ¦‚ç‡çš„"é•¿å°¾"å“åº”ã€‚å»ºè®®ä»…åœ¨é«˜çº§ç”¨ä¾‹ä¸­ä½¿ç”¨ï¼Œé€šå¸¸åªéœ€è¦è°ƒæ•´ temperatureã€‚

#### `top_p`

- ç±»å‹ï¼šæ•°å­—
- å¿…éœ€ï¼šå¦
- èŒƒå›´ï¼š0 < x < 1

ä½¿ç”¨ nucleus é‡‡æ ·ã€‚è®¡ç®—æ¯ä¸ªåç»­ token æŒ‰æ¦‚ç‡é™åºæ’åˆ—çš„ç´¯ç§¯åˆ†å¸ƒï¼Œåœ¨è¾¾åˆ° top_p æŒ‡å®šçš„æ¦‚ç‡æ—¶æˆªæ–­ã€‚å»ºè®®ä»…è°ƒæ•´ temperature æˆ– top_p å…¶ä¸­ä¹‹ä¸€ï¼Œä¸è¦åŒæ—¶ä½¿ç”¨ã€‚

## å“åº”

### æˆåŠŸå“åº”

è¿”å›ä¸€ä¸ªèŠå¤©è¡¥å…¨å¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š

#### `content`

- ç±»å‹ï¼šå¯¹è±¡æ•°ç»„
- å¿…éœ€ï¼šæ˜¯

æ¨¡å‹ç”Ÿæˆçš„å†…å®¹ï¼Œç”±å¤šä¸ªå†…å®¹å—ç»„æˆã€‚æ¯ä¸ªå†…å®¹å—éƒ½æœ‰ä¸€ä¸ªç¡®å®šå…¶å½¢çŠ¶çš„ typeã€‚å†…å®¹å—å¯ä»¥æ˜¯ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š

##### æ–‡æœ¬å†…å®¹å— (Text)

```json
{
  "type": "text",          // å¿…éœ€ï¼Œæšä¸¾å€¼: "text"ï¼Œé»˜è®¤å€¼
  "text": "ä½ å¥½ï¼Œæˆ‘æ˜¯ Claudeã€‚" // å¿…éœ€ï¼Œæœ€å¤§é•¿åº¦: 5000000ï¼Œæœ€å°é•¿åº¦: 1
}
```

##### å·¥å…·ä½¿ç”¨å†…å®¹å— (Tool Use)

```json
{
  "type": "tool_use",      // å¿…éœ€ï¼Œæšä¸¾å€¼: "tool_use"ï¼Œé»˜è®¤å€¼
  "id": "toolu_xyz...",    // å¿…éœ€ï¼Œå·¥å…·ä½¿ç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦
  "name": "get_weather",   // å¿…éœ€ï¼Œå·¥å…·åç§°ï¼Œæœ€å°é•¿åº¦: 1
  "input": {              // å¿…éœ€ï¼Œå·¥å…·çš„è¾“å…¥å‚æ•°å¯¹è±¡
    // å·¥å…·è¾“å…¥å‚æ•°ï¼Œå…·ä½“æ ¼å¼ç”±å·¥å…·çš„ input_schema å®šä¹‰
  }
}
```

ç¤ºä¾‹ï¼š
```json
// æ–‡æœ¬å†…å®¹ç¤ºä¾‹
[{"type": "text", "text": "ä½ å¥½ï¼Œæˆ‘æ˜¯ Claudeã€‚"}]

// å·¥å…·ä½¿ç”¨ç¤ºä¾‹
[{
  "type": "tool_use",
  "id": "toolu_xyz...",
  "name": "get_weather",
  "input": { "location": "åŒ—äº¬" }
}]

// æ··åˆå†…å®¹ç¤ºä¾‹
[
  {"type": "text", "text": "æ ¹æ®å¤©æ°”æŸ¥è¯¢ç»“æœï¼š"},
  {
    "type": "tool_use",
    "id": "toolu_xyz...",
    "name": "get_weather",
    "input": { "location": "åŒ—äº¬" }
  }
]
```

å¦‚æœè¯·æ±‚çš„æœ€åä¸€æ¡æ¶ˆæ¯æ˜¯åŠ©æ‰‹è§’è‰²ï¼Œå“åº”å†…å®¹ä¼šç›´æ¥ä»è¯¥æ¶ˆæ¯ç»§ç»­ã€‚ä¾‹å¦‚ï¼š

```json
// è¯·æ±‚
[
  {"role": "user", "content": "å¤ªé˜³çš„å¸Œè…Šè¯­åå­—æ˜¯ä»€ä¹ˆ? (A) Sol (B) Helios (C) Sun"},
  {"role": "assistant", "content": "æ­£ç¡®ç­”æ¡ˆæ˜¯ ("}
]

// å“åº”
[{"type": "text", "text": "B)"}]
```

#### `id`

- ç±»å‹ï¼šå­—ç¬¦ä¸²
- å¿…éœ€ï¼šæ˜¯

å“åº”çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

#### `model`

- ç±»å‹ï¼šå­—ç¬¦ä¸²
- å¿…éœ€ï¼šæ˜¯

ä½¿ç”¨çš„æ¨¡å‹åç§°ã€‚

#### `role`

- ç±»å‹ï¼šæšä¸¾å­—ç¬¦ä¸²
- å¿…éœ€ï¼šæ˜¯
- é»˜è®¤å€¼ï¼šassistant

ç”Ÿæˆæ¶ˆæ¯çš„ä¼šè¯è§’è‰²ï¼Œå§‹ç»ˆä¸º "assistant"ã€‚

#### `stop_reason`

- ç±»å‹ï¼šæšä¸¾å­—ç¬¦ä¸²æˆ– null
- å¿…éœ€ï¼šæ˜¯

åœæ­¢ç”Ÿæˆçš„åŸå› ï¼Œå¯èƒ½çš„å€¼åŒ…æ‹¬ï¼š

- `"end_turn"`: æ¨¡å‹è¾¾åˆ°è‡ªç„¶åœæ­¢ç‚¹
- `"max_tokens"`: è¶…è¿‡è¯·æ±‚çš„ max_tokens æˆ–æ¨¡å‹çš„æœ€å¤§é™åˆ¶
- `"stop_sequence"`: ç”Ÿæˆäº†è‡ªå®šä¹‰åœæ­¢åºåˆ—ä¹‹ä¸€
- `"tool_use"`: æ¨¡å‹è°ƒç”¨äº†ä¸€ä¸ªæˆ–å¤šä¸ªå·¥å…·

åœ¨éæµå¼æ¨¡å¼ä¸‹ï¼Œæ­¤å€¼å§‹ç»ˆéç©ºã€‚åœ¨æµå¼æ¨¡å¼ä¸‹ï¼Œåœ¨ message_start äº‹ä»¶ä¸­ä¸º nullï¼Œå…¶ä»–æƒ…å†µä¸‹éç©ºã€‚

#### `stop_sequence`

- ç±»å‹ï¼šå­—ç¬¦ä¸²æˆ– null
- å¿…éœ€ï¼šæ˜¯

ç”Ÿæˆçš„è‡ªå®šä¹‰åœæ­¢åºåˆ—ã€‚å¦‚æœæ¨¡å‹é‡åˆ°äº† stop_sequences å‚æ•°ä¸­æŒ‡å®šçš„æŸä¸ªåºåˆ—ï¼Œè¿™ä¸ªå­—æ®µå°†åŒ…å«è¯¥åŒ¹é…çš„åœæ­¢åºåˆ—ã€‚å¦‚æœä¸æ˜¯å› ä¸ºåœæ­¢åºåˆ—è€Œåœæ­¢ï¼Œåˆ™ä¸º nullã€‚

#### `type`

- ç±»å‹ï¼šæšä¸¾å­—ç¬¦ä¸²
- å¿…éœ€ï¼šæ˜¯
- é»˜è®¤å€¼ï¼šmessage
- å¯é€‰å€¼ï¼šmessage

å¯¹è±¡ç±»å‹ï¼Œå¯¹äº Messages å§‹ç»ˆä¸º "message"ã€‚

#### `usage`

- ç±»å‹ï¼šå¯¹è±¡
- å¿…éœ€ï¼šæ˜¯

è®¡è´¹å’Œé™æµç›¸å…³çš„ä½¿ç”¨é‡ç»Ÿè®¡ã€‚åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

- `input_tokens`: ä½¿ç”¨çš„è¾“å…¥ token æ•°é‡ï¼Œå¿…éœ€ï¼ŒèŒƒå›´ x > 0
- `output_tokens`: ä½¿ç”¨çš„è¾“å‡º token æ•°é‡ï¼Œå¿…éœ€ï¼ŒèŒƒå›´ x > 0
- `cache_creation_input_tokens`: åˆ›å»ºç¼“å­˜æ¡ç›®ä½¿ç”¨çš„è¾“å…¥ token æ•°é‡(å¦‚æœé€‚ç”¨)ï¼Œå¿…éœ€ï¼ŒèŒƒå›´ x > 0
- `cache_read_input_tokens`: ä»ç¼“å­˜è¯»å–çš„è¾“å…¥ token æ•°é‡(å¦‚æœé€‚ç”¨)ï¼Œå¿…éœ€ï¼ŒèŒƒå›´ x > 0

æ³¨æ„ï¼šç”±äº API åœ¨å†…éƒ¨ä¼šå¯¹è¯·æ±‚è¿›è¡Œè½¬æ¢å’Œè§£æï¼Œtoken è®¡æ•°å¯èƒ½ä¸è¯·æ±‚å’Œå“åº”çš„å®é™…å¯è§å†…å®¹ä¸å®Œå…¨å¯¹åº”ã€‚ä¾‹å¦‚ï¼Œå³ä½¿æ˜¯ç©ºå­—ç¬¦ä¸²å“åº”ï¼Œoutput_tokens ä¹Ÿä¼šæ˜¯éé›¶å€¼ã€‚

### é”™è¯¯å“åº”

å½“è¯·æ±‚å‡ºç°é—®é¢˜æ—¶ï¼ŒAPI å°†è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”å¯¹è±¡ï¼ŒHTTP çŠ¶æ€ç åœ¨ 4XX-5XX èŒƒå›´å†…ã€‚

#### å¸¸è§é”™è¯¯çŠ¶æ€ç 

- `401 Unauthorized`: API å¯†é’¥æ— æ•ˆæˆ–æœªæä¾›
- `400 Bad Request`: è¯·æ±‚å‚æ•°æ— æ•ˆ
- `429 Too Many Requests`: è¶…å‡º API è°ƒç”¨é™åˆ¶
- `500 Internal Server Error`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

é”™è¯¯å“åº”ç¤ºä¾‹:

```json
{
  "error": {
    "type": "invalid_request_error",
    "message": "Invalid API key provided",
    "code": "invalid_api_key"
  }
}
```

ä¸»è¦é”™è¯¯ç±»å‹:

- `invalid_request_error`: è¯·æ±‚å‚æ•°é”™è¯¯
- `authentication_error`: è®¤è¯ç›¸å…³é”™è¯¯
- `rate_limit_error`: è¯·æ±‚é¢‘ç‡è¶…é™
- `server_error`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯